<!-- 1) Buscar slug existente -->
<div class="flex gap-2 mb-4">
  <input
    type="text"
    name="searchSlug"
    [ngModel]="searchSlugInput()"
    (ngModelChange)="searchSlugInput.set($event)"
    [ngModelOptions]="{ standalone: true }"
    placeholder="Slug de producto"
    class="rounded border p-2 flex-1"
  />
  <button
    type="button"
    (click)="loadProduct()"
    class="rounded bg-blue-600 text-white px-4"
  >
    Buscar
  </button>
</div>

<!-- 2) Formulario de creación/edición -->
<form (ngSubmit)="save()" #productForm="ngForm" class="space-y-4 p-4">
  <!-- Título -->
  <div>
    <label for="title" class="block font-medium">Título</label>
    <input
      type="text"
      id="title"
      name="title"
      [ngModel]="product().title"
      (ngModelChange)="updateTitle($event)"
      required
      class="w-full rounded border p-2"
    />
  </div>

  <!-- Descripción -->
  <div>
    <label for="description" class="block font-medium">Descripción</label>
    <textarea
      id="description"
      name="description"
      [ngModel]="product().description"
      (ngModelChange)="updateDescription($event)"
      required
      class="w-full rounded border p-2"
    ></textarea>
  </div>

  <!-- Precio -->
  <div>
    <label for="price" class="block font-medium">Precio</label>
    <input
      type="number"
      id="price"
      name="price"
      [ngModel]="product().price"
      (ngModelChange)="updatePrice($event)"
      required
      class="w-full rounded border p-2"
    />
  </div>

  <!-- Departamento -->
  <div>
    <label for="department" class="block font-medium">Departamento</label>
    <select
      id="department"
      name="department"
      [(ngModel)]="selectedDepartmentId"
      (change)="onDepartmentChange($event)"
      required
      class="w-full rounded border p-2"
    >
      <option [ngValue]="null">Seleccione un Departamento</option>
      <option *ngFor="let d of departments()" [ngValue]="d.id">
        {{ d.name }}
      </option>
    </select>
  </div>

  <!-- Categoría -->
  <div>
    <label for="category" class="block font-medium">Categoría</label>
    <select
      id="category"
      name="category"
      [(ngModel)]="selectedCategoryId"
      required
      class="w-full rounded border p-2"
    >
      <option [ngValue]="null">Seleccione una Categoría</option>
      <option *ngFor="let c of filteredCategories" [ngValue]="c.id">
        {{ c.name }}
      </option>
    </select>
  </div>

  <!-- Características -->
  <div class="space-y-2">
    <label for="features" class="block font-medium">Características</label>
    <div class="flex gap-2">
      <input
        type="text"
        id="feature"
        name="feature"
        [ngModel]="featureInput()"
        (ngModelChange)="featureInput.set($event)"
        [ngModelOptions]="{ standalone: true }"
        placeholder="Ej. ‘Resistente al agua’"
        class="flex-1 rounded border p-2"
      />
      <button
        type="button"
        (click)="addFeature()"
        class="rounded bg-green-500 px-4 text-white"
      >
        Añadir
      </button>
    </div>
    <ul class="list-disc ml-6">
      @for (feat of product().features; track feat) {
        <li class="flex justify-between items-center">
          {{ feat }}
          <button
            type="button"
            (click)="removeFeature(feat)"
            class="text-red-600 font-bold"
          >
            &times;
          </button>
        </li>
      }
    </ul>
  </div>

  <!-- Imagen -->
  <div>
    <label for="image" class="block font-medium">Imagen</label>
    <input
      type="file"
      id="image"
      (change)="onFileSelected($event)"
      accept="image/*"
      class="w-full"
    />
    <div *ngIf="imagePreview()" class="mt-2">
      <p class="text-sm text-gray-500">Vista previa:</p>
      <img
        [src]="imagePreview()"
        alt="Vista previa"
        class="h-40 w-auto rounded"
      />
    </div>
  </div>

  <!-- Botones -->
  <div class="flex gap-2">
    <button
      type="submit"
      [disabled]="productForm.invalid"
      class="rounded bg-green-600 text-white px-4 py-2"
    >
      {{ isEdit() ? 'Guardar cambios' : 'Crear producto' }}
    </button>
    <button
      *ngIf="isEdit()"
      type="button"
      (click)="delete()"
      class="rounded bg-red-600 text-white px-4 py-2"
    >
      Eliminar producto
    </button>
    <button
      type="button"
      (click)="resetForm()"
      class="rounded bg-gray-400 text-white px-4 py-2"
    >
      Limpiar
    </button>
  </div>
</form>
